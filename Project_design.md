# 国土交通省 入札案件抽出 Chrome拡張機能 - 開発仕様書

**関連ドキュメント**: Project_TODO.md, Project_Test.md, Project_TestCase.md

----------------------------------------------------------------
## 1. ビジョン (L0)
- **目的**: 入札情報サービスの工事案件概要ページから必要な情報を効率的に抽出し、スプレッドシートへの貼り付け用データとして整形する
- **成功指標 (KPI)**
  - 抽出処理時間 ≤ 3秒
  - データ抽出精度 100%
  - 月次アクティブユーザー ≥ 50人

----------------------------------------------------------------
## 2. スコープ & UX (L1)

### 2.1 ペルソナ
- 入札業務担当者: ITリテラシー中程度／入札情報の効率的な収集・管理を行いたい
- 行政書士・コンサルタント: 複数の入札案件を管理し、クライアントへの報告資料を作成したい

### 2.2 ユーザーストーリー
1. ユーザーは入札情報サービスの案件概要ページで拡張機能アイコンをクリックし、データを抽出したい
2. ユーザーは抽出されたデータをクリップボードから直接スプレッドシートに貼り付けたい
3. ユーザーは設定画面で抽出オプションをカスタマイズしたい

### 2.3 主要フロー
1. **入札情報サービスのページを開く**
2. **拡張機能アイコンをクリック**
3. **データ自動抽出・整形**
4. **クリップボードへコピー**
5. **完了通知表示**

### 2.4 UI設計

#### 2.4.1 拡張機能ポップアップ
```
┌─────────────────────────────────────────┐
│  国土交通省 入札案件抽出                │
├─────────────────────────────────────────┤
│  [データを抽出]                         │
│                                         │
│  抽出状態: 待機中                       │
│                                         │
│  [設定] [ヘルプ]                       │
└─────────────────────────────────────────┘
```

#### 2.4.2 設定画面
```
┌─────────────────────────────────────────┐
│  設定                                   │
├─────────────────────────────────────────┤
│  □ 抽出後に自動でクリップボードにコピー │
│  □ 完了時に通知を表示                  │
│  □ デバッグモード                      │
│                                         │
│  [保存] [キャンセル]                   │
└─────────────────────────────────────────┘
```

----------------------------------------------------------------
## 3. 想定ディレクトリ構成 (L2)

```
/src
├─ manifest.json
├─ popup/
│  ├─ popup.html
│  ├─ popup.js
│  └─ popup.css
├─ content/
│  ├─ content.js
│  └─ extractor.js
├─ background/
│  └─ background.js
├─ options/
│  ├─ options.html
│  ├─ options.js
│  └─ options.css
├─ lib/
│  ├─ constants.js
│  ├─ utils.js
│  └─ formatter.js
├─ assets/
│  └─ icons/
│      ├─ icon16.png
│      ├─ icon48.png
│      └─ icon128.png
└─ tests/
    ├─ unit/
    └─ e2e/
```

----------------------------------------------------------------
## 4. システムアーキテクチャ

```
┌────────────────────────────────────────┐
│     Chrome ブラウザ                    │
├────────────────────────────────────────┤
│  ┌──────────────┐  ┌────────────────┐│
│  │ Content Script│  │ Popup UI       ││
│  │              │←→│                ││
│  └──────────────┘  └────────────────┘│
│          ↑                    ↑        │
│          └────────┬───────────┘        │
│                   ↓                    │
│          ┌─────────────────┐          │
│          │ Background Script│          │
│          └─────────────────┘          │
└────────────────────────────────────────┘
         ↓
┌────────────────────────────────────────┐
│        クリップボード                  │
└────────────────────────────────────────┘
```

----------------------------------------------------------------
## 5. 技術スタック
- **フロントエンド**: Vanilla JavaScript, HTML5, CSS3
- **Chrome APIs**: 
  - chrome.runtime (メッセージング)
  - chrome.storage (設定保存)
  - chrome.tabs (タブ操作)
  - chrome.notifications (通知)
- **ビルドツール**: webpack, babel
- **テスト**: Jest (unit), Puppeteer (e2e)
- **CI/CD**: GitHub Actions

----------------------------------------------------------------
## 6. データ抽出仕様

### 6.1 抽出対象項目
- 発注機関
- 工事名称
- 工事場所
- 工事種別／工事の業種
- 設計書番号
- 公告日時
- 期限日時
- 開札日時
- 公開状態の公開中に設定されているPDFURL

### 6.2 出力フォーマット (タブ区切り)
```
A列: 空欄
B列: 工事名称
C列: 設計書番号
D列: 発注機関の内、～省or内閣府or～県orいずれもない場合は発注機関の全文言
E列: 発注機関の内、D列以外を除いた全文言。D列に全て記載してしまった場合は空欄
F列: 公告日時
G列: 空欄
H列: 期限日時
I列: 開札日時
J列: 公開状態の公開中に設定されているPDFURL
K列: 空欄
L列: 工事種別／工事の業種
```

----------------------------------------------------------------
## 7. 非機能要件
- **パフォーマンス**: 抽出処理は3秒以内に完了
- **互換性**: Chrome 90以上
- **セキュリティ**: 
  - Content Security Policy準拠
  - 外部サーバーへのデータ送信なし
  - ローカル処理のみ
- **アクセシビリティ**: WCAG 2.1 AA準拠
- **エラーハンドリング**: 
  - DOM要素が見つからない場合の適切な処理
  - ネットワークエラー時の再試行機能

----------------------------------------------------------------
## 8. 開発ロードマップ
- **Phase 1 (1週間)**: 基本構造とmanifest.json作成
- **Phase 2 (1週間)**: Content Scriptによるデータ抽出機能実装
- **Phase 3 (1週間)**: Popup UIとBackground Script実装
- **Phase 4 (3日)**: 設定画面とオプション機能実装
- **Phase 5 (3日)**: テストとデバッグ
- **Phase 6 (1日)**: Chrome Web Storeへの公開準備

----------------------------------------------------------------
## 9. SOLID原則の適用

### 9.1 単一責任の原則 (SRP)
- extractor.js: DOM要素からのデータ抽出のみ
- formatter.js: データの整形のみ
- background.js: Chrome API通信の管理のみ

### 9.2 オープン・クローズドの原則 (OCP)
- 新しい抽出項目の追加は設定オブジェクトの拡張で対応
- 既存コードの変更を最小限に

### 9.3 リスコフの置換原則 (LSP)
- 各モジュールは定義されたインターフェースに従う

### 9.4 インターフェース分離の原則 (ISP)
- 各モジュールは必要最小限のメソッドのみ公開

### 9.5 依存性逆転の法則 (DIP)
- 具体的な実装ではなく抽象に依存

----------------------------------------------------------------
## 10. 参考資料
- Chrome Extension API Documentation
- 入札情報サービス利用規約
- スプレッドシート連携ベストプラクティス