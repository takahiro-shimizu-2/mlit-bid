# 国土交通省 入札案件抽出 Chrome拡張機能 - テスト仕様書

**関連ドキュメント**: Project_design.md, Project_TODO.md, Project_TestCase.md  
**作成日**: 2025年7月20日  
**バージョン**: 1.0

----------------------------------------------------------------

## 1. テスト概要

### 1.1 テスト目的
Chrome拡張機能「国土交通省 入札案件抽出」が要件定義書およびProject_design.mdで定義された機能を正しく実装し、期待される品質基準を満たすことを確認する。

### 1.2 テスト範囲
- データ抽出機能
- データ整形機能
- クリップボードコピー機能
- UI操作
- 設定機能
- エラーハンドリング

### 1.3 テスト環境
- OS: Windows 10/11, macOS 10.15以上
- ブラウザ: Google Chrome 90以上
- テストツール: Jest（単体テスト）、Puppeteer（E2Eテスト）

----------------------------------------------------------------

## 2. テスト戦略

### 2.1 テストレベル
1. **単体テスト**: 個々の関数・モジュールの動作確認
2. **統合テスト**: モジュール間の連携確認
3. **E2Eテスト**: ユーザーシナリオに基づく全体動作確認
4. **受け入れテスト**: 要件定義との適合性確認

### 2.2 テスト種別
- **機能テスト**: 各機能が仕様通りに動作することを確認
- **非機能テスト**: パフォーマンス、セキュリティ、互換性を確認
- **回帰テスト**: 修正による既存機能への影響を確認

----------------------------------------------------------------

## 3. 単体テスト仕様

### 3.1 extractor.js

#### 3.1.1 extractData()関数
**テスト項目**:
- 正常系: すべての要素が存在する場合のデータ抽出
- 異常系: 一部の要素が存在しない場合の処理
- 異常系: DOM要素のIDが変更された場合の処理

**期待結果**:
- 正常系: すべてのデータが正しく抽出される
- 異常系: エラーをスローせず、空文字列を返す

#### 3.1.2 extractPDFUrl()関数
**テスト項目**:
- 正常系: PDFリンクが存在する場合
- 正常系: 拡張子が.pdf以外の場合
- 異常系: リンクが存在しない場合

**期待結果**:
- 正常系: 正しいURLが抽出される
- 異常系: 空文字列を返す

### 3.2 formatter.js

#### 3.2.1 formatData()関数
**テスト項目**:
- 正常系: 完全なデータセットの整形
- 正常系: 一部データが欠損している場合の整形
- 境界値: 特殊文字を含むデータの処理

**期待結果**:
- タブ区切り形式で正しく整形される
- 欠損データは空文字列として処理される

#### 3.2.2 parseOrganization()関数
**テスト項目**:
- 「防衛省北関東防衛局」→ D列:「防衛省」、E列:「北関東防衛局」
- 「東京都建設局」→ D列:「東京都」、E列:「建設局」
- 「内閣府」→ D列:「内閣府」、E列:空欄
- 「○○建設株式会社」→ D列:「○○建設株式会社」、E列:空欄

**期待結果**:
- 各パターンで正しく分割される

### 3.3 utils.js

#### 3.3.1 日付フォーマット関数
**テスト項目**:
- 正常系: 「2025年07月18日 00時00分」形式の処理
- 異常系: 不正な日付形式の処理

**期待結果**:
- 正常系: 正しくフォーマットされる
- 異常系: 元の文字列をそのまま返す

----------------------------------------------------------------

## 4. 統合テスト仕様

### 4.1 Content Script - Background Script連携
**テスト項目**:
- メッセージ送受信の正常動作
- エラー時のメッセージハンドリング
- タイムアウト処理

**期待結果**:
- 正常にデータが受け渡される
- エラーが適切に伝播される

### 4.2 Popup - Content Script連携
**テスト項目**:
- ボタンクリック時のメッセージ送信
- 抽出結果の受信と表示
- エラー表示

**期待結果**:
- ユーザー操作に応じて正しく動作する

----------------------------------------------------------------

## 5. E2Eテスト仕様

### 5.1 基本シナリオ
**前提条件**: 入札情報サービスの案件概要ページを開いている

**テスト手順**:
1. 拡張機能アイコンをクリック
2. 「データを抽出」ボタンをクリック
3. 抽出完了を確認
4. スプレッドシートに貼り付け

**期待結果**:
- データが正しい形式でクリップボードにコピーされる
- スプレッドシートの各列に正しくデータが配置される

### 5.2 設定変更シナリオ
**テスト手順**:
1. 設定画面を開く
2. 「自動でクリップボードにコピー」をOFFにする
3. データ抽出を実行
4. 手動でコピー操作を行う

**期待結果**:
- 設定が正しく反映される
- 自動コピーが無効化される

----------------------------------------------------------------

## 6. 非機能テスト仕様

### 6.1 パフォーマンステスト
**測定項目**:
- データ抽出処理時間
- メモリ使用量
- CPU使用率

**合格基準**:
- 処理時間: 3秒以内
- メモリ使用量: 50MB以下
- CPU使用率: 10%以下

### 6.2 互換性テスト
**テスト環境**:
- Chrome 90, 100, 110, 最新版
- Windows 10, Windows 11
- macOS 10.15, 11, 12

**期待結果**:
- すべての環境で正常動作

### 6.3 セキュリティテスト
**テスト項目**:
- 外部通信の有無
- ローカルストレージの安全性
- CSP準拠

**期待結果**:
- 外部通信が発生しない
- 機密情報が保存されない

----------------------------------------------------------------

## 7. 回帰テスト

### 7.1 テスト実施タイミング
- 機能追加・修正時
- Chrome API更新時
- 入札情報サービスのDOM変更対応時

### 7.2 テスト範囲
- すべての単体テスト
- 主要なE2Eテストシナリオ

----------------------------------------------------------------

## 8. テストデータ

### 8.1 正常系テストデータ
```javascript
{
  organization: "防衛省北関東防衛局",
  projectName: "下総（７）航空管制施設整備工事",
  location: "千葉県柏市",
  projectType: "電気通信",
  designNumber: "0010040000420250155",
  announcementDate: "2025年07月18日 00時00分",
  deadline: "2025年07月31日 12時00分",
  openingDate: "2025年10月02日 10時00分",
  pdfUrl: "https://www.mod.go.jp/rdb/n-kanto/nyusatsu-keiyaku/kensetu/kouji/R7k-030.pdf"
}
```

### 8.2 異常系テストデータ
- 要素が見つからない場合
- 日付形式が異なる場合
- PDFリンクが存在しない場合

----------------------------------------------------------------

## 9. バグ管理

### 9.1 バグ分類
- Critical: 機能が全く動作しない
- Major: 主要機能に影響
- Minor: 軽微な不具合
- Trivial: 改善要望

### 9.2 バグ報告フォーマット
- 発生環境
- 再現手順
- 期待動作
- 実際の動作
- スクリーンショット

----------------------------------------------------------------

## 10. テスト完了基準

### 10.1 定量的基準
- 単体テストカバレッジ: 80%以上
- E2Eテスト成功率: 100%
- Critical/Majorバグ: 0件

### 10.2 定性的基準
- 要件定義書の全機能が実装・検証済み
- ユーザビリティに重大な問題がない
- パフォーマンス基準を満たす

----------------------------------------------------------------

## 11. テストスケジュール

| フェーズ | 期間 | 内容 |
|---------|------|------|
| 単体テスト作成・実施 | 2日 | 各モジュールのテスト |
| 統合テスト実施 | 1日 | モジュール間連携テスト |
| E2Eテスト実施 | 1日 | シナリオテスト |
| 非機能テスト実施 | 1日 | パフォーマンス・互換性テスト |
| バグ修正・再テスト | 2日 | 不具合対応 |

----------------------------------------------------------------

## 12. リスクと対策

### 12.1 テストリスク
- **リスク**: 入札情報サービスのテスト環境がない
- **対策**: 保存したHTMLファイルを使用してテスト

### 12.2 品質リスク
- **リスク**: DOM構造の変更による機能停止
- **対策**: セレクターの定期的な確認と更新