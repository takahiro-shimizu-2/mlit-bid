# Chrome拡張機能テストガイド

## テスト環境のセットアップ

### 1. Chrome拡張機能の読み込み

1. Google Chromeを開く
2. アドレスバーに `chrome://extensions/` を入力
3. 右上の「デベロッパーモード」をONにする
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. `mlit-bid/src` フォルダを選択

### 2. manifest.jsonの修正（ローカルテスト用）

テストページでも動作するよう、一時的にmanifest.jsonを修正します：

```json
"content_scripts": [
  {
    "matches": [
      "https://www.i-ppi.jp/IPPI/SearchServices/Web/Koji/Kokoku/List_Detail.aspx*",
      "https://www.i-ppi.jp/IPPI/SearchServices/Web/Koji/Kokoku/List.aspx*",
      "file:///*/test/test-page.html"  // ← この行を追加
    ],
    "js": ["content/content.js", "content/extractor.js"],
    "run_at": "document_end"
  }
]
```

## テスト手順

### 基本的なデータ抽出テスト

1. `test/test-page.html` をChromeで開く
2. 拡張機能のアイコンをクリック
3. 「データを抽出」ボタンをクリック
4. 「データを抽出してクリップボードにコピーしました」と表示されることを確認

### クリップボードの内容確認

1. スプレッドシート（Google SheetsやExcel）を開く
2. A1セルを選択して貼り付け（Ctrl+V / Cmd+V）
3. 以下の形式でデータが貼り付けられることを確認：

| A列 | B列 | C列 | D列 | E列 | F列 | G列 | H列 | I列 | J列 | K列 | L列 |
|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|
| (空) | 令和6年度 国道1号線舗装修繕工事 | R06-KT-001234 | 国土交通省 | 関東地方整備局 東京国道事務所 | 令和6年7月1日 10時00分 | (空) | 令和6年7月20日 17時00分 | 令和6年7月22日 10時00分 | (PDFのURL) | (空) | 舗装工事 |

### 発注機関パターンのテスト

1. テストページの「省庁パターンに変更」ボタンをクリック
2. 拡張機能でデータを抽出
3. D列に「内閣府」、E列に「政策統括官（防災担当）」と分割されることを確認

4. 「都道府県パターンに変更」ボタンをクリック
5. 拡張機能でデータを抽出
6. D列に「東京都」、E列に「建設局 道路建設部」と分割されることを確認

7. 「その他パターンに変更」ボタンをクリック
8. 拡張機能でデータを抽出
9. D列に「独立行政法人都市再生機構 東日本賃貸住宅本部」、E列が空欄になることを確認


### エラーケースのテスト

1. 対象外のページ（例：Google）で拡張機能を開く
2. 「非対応ページ」と表示され、抽出ボタンが無効になることを確認

## トラブルシューティング

### 拡張機能が表示されない場合
- Chrome拡張機能ページで拡張機能が有効になっているか確認
- エラーが表示されている場合は「詳細」をクリックして内容を確認

### データが抽出されない場合
- 開発者ツール（F12）のコンソールタブでエラーを確認
- manifest.jsonにテストページのURLパターンが追加されているか確認

### クリップボードにコピーされない場合
- 拡張機能の権限設定を確認
- ブラウザの設定でクリップボードへのアクセスが許可されているか確認

## デバッグ方法

1. 開発者ツール（F12）を開く
2. コンソールタブで以下のようなログを確認：
   - `[MLIT Bid Extension] Ready for data extraction`
   - `[MLIT Bid Extension] Data extraction started`
   - 抽出されたデータの詳細

## 本番環境でのテスト

実際の入札情報サービスでテストする場合：
1. https://www.i-ppi.jp にアクセス
2. 工事案件を検索して詳細ページを開く
3. 上記と同じ手順でテスト実施