# Chrome拡張機能テストガイド

**更新日**: 2025年7月21日  
**バージョン**: 1.0.1  
**対応**: 詳細ページ専用Chrome拡張機能

## テスト環境のセットアップ

### 1. Chrome拡張機能の読み込み

1. Google Chromeを開く
2. アドレスバーに `chrome://extensions/` を入力
3. 右上の「デベロッパーモード」をONにする
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. `mlit-bid/src` フォルダを選択

### 2. manifest.jsonの修正（ローカルテスト用）

テストページでも動作するよう、一時的にmanifest.jsonを修正します：

```json
"content_scripts": [
  {
    "matches": [
      "https://www.i-ppi.jp/IPPI/SearchServices/Web/Koji/Kokoku/List_Detail.aspx*",
      "file:///*/test/*.html"  // ← この行を追加
    ],
    "js": ["content/formatter.js", "content/extractor.js", "content/content.js"],
    "run_at": "document_end"
  }
]
```

## テスト手順

### 基本的なデータ抽出テスト

1. テストページ（`test/testpage.html`, `testpage1.html`, `testpage2.html`）をChromeで開く
2. 拡張機能のアイコンをクリック
3. 「📄 入札情報を取得」ボタンをクリック
4. 「入札情報を抽出してクリップボードにコピーしました。」と表示されることを確認

### クリップボードの内容確認

1. スプレッドシート（Google SheetsやExcel）を開く
2. A1セルを選択して貼り付け（Ctrl+V / Cmd+V）
3. 以下の形式でデータが貼り付けられることを確認：

| A列 | B列 | C列 | D列 | E列 | F列 | G列 | H列 | I列 | J列 | K列 | L列 |
|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|
| (空) | 県営かんがい排水事業... | (空) | 岐阜県 | (空) | 2025年07月22日 00時00分 | (空) | 2025年07月28日 16時00分 | (空) | https://www.pref.gifu... | (空) | 土木一式工事 |

### 発注機関パターンのテスト

#### 防衛省パターン（testpage1.html）
- D列: 「防衛省」
- E列: 「北関東防衛局」

#### 国土交通省パターン（Sample/testpage.html）
- D列: 「国土交通省」
- E列: 「東北地方整備局」

#### 岐阜県パターン（testpage2.html）
- D列: 「岐阜県」
- E列: 空欄


### エラーケースのテスト

1. 一覧ページ（List.aspx）で拡張機能を実行
2. 「入札案件の詳細ページでのみ使用できます。」とエラーメッセージが表示されることを確認

### PDF URL抽出のテスト

1. 防衛省案件（.pdfリンク）: 直接PDFファイルへのリンクが取得される
2. 岐阜県・国土交通省案件: 「入札公告」行の公開中リンクが取得される

## トラブルシューティング

### 拡張機能が表示されない場合
- Chrome拡張機能ページで拡張機能が有効になっているか確認
- エラーが表示されている場合は「詳細」をクリックして内容を確認

### データが抽出されない場合
- 開発者ツール（F12）のコンソールタブでエラーを確認
- manifest.jsonにテストページのURLパターンが追加されているか確認

### クリップボードにコピーされない場合
- 拡張機能の権限設定を確認
- ブラウザの設定でクリップボードへのアクセスが許可されているか確認

## デバッグ方法

1. 開発者ツール（F12）を開く
2. コンソールタブでログを確認
3. 拡張機能のポップアップを右クリック→「検証」でポップアップのコンソールも確認

## 本番環境でのテスト

実際の入札情報サービスでテストする場合：
1. https://www.i-ppi.jp にアクセス
2. 工事案件を検索して**詳細ページ**（List_Detail.aspx）を開く
3. 上記と同じ手順でテスト実施

## 更新履歴

### v1.0.1 (2025-07-21)
- 詳細ページ専用に更新
- PDF URL抽出方法の改善（dgrKokokuテーブルから取得）
- テストページの更新