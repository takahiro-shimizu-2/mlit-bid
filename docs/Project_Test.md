# 国土交通省 入札案件抽出 Chrome拡張機能 - テスト仕様書

**関連ドキュメント**: Project_design.md, Project_TODO.md, Project_TestCase.md  
**更新日**: 2025年7月21日  
**バージョン**: 2.0

----------------------------------------------------------------

## 1. テスト概要

### 1.1 テスト目的
Chrome拡張機能「国土交通省 入札案件抽出」が要件定義書およびProject_design.mdで定義された機能を正しく実装し、期待される品質基準を満たすことを確認する。

### 1.2 テスト範囲
- データ抽出機能（詳細ページのみ）
- データ整形機能
- クリップボードコピー機能
- UI操作（1ボタンのシンプルUI）
- エラーハンドリング

### 1.3 テスト環境
- OS: Windows 10/11, macOS 10.15以上
- ブラウザ: Google Chrome 90以上
- 対象ページ: 入札情報サービス詳細ページ（List_Detail.aspx）

----------------------------------------------------------------

## 2. テスト戦略

### 2.1 テストレベル
1. **単体テスト**: 個々の関数・モジュールの動作確認
2. **統合テスト**: モジュール間の連携確認
3. **E2Eテスト**: ユーザーシナリオに基づく全体動作確認
4. **受け入れテスト**: 要件定義との適合性確認

### 2.2 テスト種別
- **機能テスト**: 各機能が仕様通りに動作することを確認
- **非機能テスト**: パフォーマンス、互換性を確認
- **回帰テスト**: 修正による既存機能への影響を確認

----------------------------------------------------------------

## 3. 単体テスト仕様

### 3.1 extractor.js

#### 3.1.1 extractData()関数
**テスト項目**:
- 正常系: すべての要素が存在する場合のデータ抽出
- 異常系: 一部の要素が存在しない場合の処理
- 異常系: 詳細ページ以外での実行

**期待結果**:
- 正常系: すべてのデータが正しく抽出される
- 異常系（要素欠損）: エラーをスローせず、空文字列を返す
- 異常系（ページ違い）: エラーメッセージ「入札案件の詳細ページでのみ使用できます。」

#### 3.1.2 extractPdfUrl()関数
**テスト項目**:
- 正常系: PDFリンクが存在する場合
- 正常系: 相対URLの場合の絶対URL変換
- 異常系: リンクが存在しない場合

**期待結果**:
- 正常系: 正しいURLが抽出される
- 異常系: 空文字列を返す

### 3.2 formatter.js

#### 3.2.1 formatData()関数
**テスト項目**:
- 正常系: 完全なデータセットの整形
- 正常系: 一部データが欠損している場合の整形
- 境界値: 特殊文字を含むデータの処理

**期待結果**:
- タブ区切り形式で正しく整形される
- 欠損データは空文字列として処理される

#### 3.2.2 parseOrganization()関数
**テスト項目**:
- 「防衛省北関東防衛局」→ D列:「防衛省」、E列:「北関東防衛局」
- 「東京都建設局」→ D列:「東京都」、E列:「建設局」
- 「内閣府」→ D列:「内閣府」、E列:空欄
- 「○○建設株式会社」→ D列:「○○建設株式会社」、E列:空欄

**期待結果**:
- 各パターンで正しく分割される

### 3.3 content.js

#### 3.3.1 handleExtraction()関数
**テスト項目**:
- 正常系: 詳細ページでの実行
- 異常系: 詳細ページ以外での実行
- 異常系: DOM要素が見つからない場合

**期待結果**:
- 正常系: データが正しく抽出・整形される
- 異常系: 適切なエラーメッセージが返される

----------------------------------------------------------------

## 4. 統合テスト仕様

### 4.1 Content Script - Background Script連携
**テスト項目**:
- クリップボードコピーのメッセージ送受信
- エラー時のメッセージハンドリング

**期待結果**:
- 正常にデータがクリップボードにコピーされる
- エラーが適切に伝播される

### 4.2 Popup - Content Script連携
**テスト項目**:
- ボタンクリック時のメッセージ送信
- pingによるスクリプト存在確認
- 必要時のスクリプト注入
- 抽出結果の受信と表示
- エラー表示

**期待結果**:
- ユーザー操作に応じて正しく動作する
- エラーメッセージが適切に表示される

----------------------------------------------------------------

## 5. E2Eテスト仕様

### 5.1 基本シナリオ
**前提条件**: 入札情報サービスの案件詳細ページを開いている

**テスト手順**:
1. 拡張機能アイコンをクリック
2. 「入札情報を取得」ボタンをクリック
3. 抽出完了を確認
4. スプレッドシートに貼り付け

**期待結果**:
- データが正しい形式でクリップボードにコピーされる
- スプレッドシートの各列に正しくデータが配置される

### 5.2 エラーシナリオ
**前提条件**: 一覧ページや他のページを開いている

**テスト手順**:
1. 拡張機能アイコンをクリック
2. 「入札情報を取得」ボタンをクリック

**期待結果**:
- エラーメッセージ「入札案件の詳細ページでのみ使用できます。」が表示される

----------------------------------------------------------------

## 6. 非機能テスト仕様

### 6.1 パフォーマンステスト
**測定項目**:
- データ抽出処理時間
- メモリ使用量

**合格基準**:
- 処理時間: 3秒以内
- メモリ使用量: 50MB以下

### 6.2 互換性テスト
**テスト環境**:
- Chrome 90, 100, 110, 最新版
- Windows 10, Windows 11
- macOS 10.15, 11, 12

**期待結果**:
- すべての環境で正常動作

----------------------------------------------------------------

## 7. テストデータ

### 7.1 正常系テストデータ
```javascript
{
  hachukikan: "防衛省北関東防衛局",
  kojiName: "下総（７）航空管制施設整備工事",
  kojiPlace: "千葉県柏市",
  kojiType: "電気通信",
  sekkeishoNo: "0010040000420250155",
  kokokuDate: "2025年07月18日 00時00分",
  kigenDate: "2025年07月31日 12時00分",
  kasatuDate: "2025年10月02日 10時00分",
  pdfUrl: "https://www.mod.go.jp/rdb/n-kanto/nyusatsu-keiyaku/kensetu/kouji/R7k-030.pdf"
}
```

### 7.2 異常系テストデータ
- 要素が見つからない場合
- 詳細ページ以外でのアクセス
- PDFリンクが存在しない場合

----------------------------------------------------------------

## 8. テスト完了基準

### 8.1 定量的基準
- すべてのテストケースが合格
- Critical/Majorバグ: 0件

### 8.2 定性的基準
- 要件定義書の全機能が実装・検証済み
- ユーザビリティに重大な問題がない
- パフォーマンス基準を満たす

----------------------------------------------------------------

## 9. 変更履歴

### v2.0 (2025-07-21)
- 一覧ページ関連のテストを削除
- 詳細ページ専用のテストに特化
- エラーメッセージの統一

### v1.0 (2025-07-20)
- 初版作成