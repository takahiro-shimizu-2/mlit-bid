# 国土交通省 入札案件抽出 Chrome拡張機能 - 開発仕様書

**更新日**: 2025年7月21日  
**バージョン**: 2.0  
**関連ドキュメント**: 要件定義書.md, Project_TODO.md, Project_Test.md, Project_TestCase.md

----------------------------------------------------------------
## 1. ビジョン (L0)
- **目的**: 入札情報サービスの工事案件詳細ページから必要な情報を効率的に抽出し、スプレッドシートへの貼り付け用データとして整形する
- **成功指標 (KPI)**
  - 抽出処理時間 ≤ 3秒
  - データ抽出精度 100%
  - 月次アクティブユーザー ≥ 50人

----------------------------------------------------------------
## 2. スコープ & UX (L1)

### 2.1 ペルソナ
- 入札業務担当者: ITリテラシー中程度／入札情報の効率的な収集・管理を行いたい
- 行政書士・コンサルタント: 入札案件を管理し、クライアントへの報告資料を作成したい

### 2.2 ユーザーストーリー
1. ユーザーは入札情報サービスの案件詳細ページで拡張機能アイコンをクリックし、データを抽出したい
2. ユーザーは抽出されたデータをクリップボードから直接スプレッドシートに貼り付けたい

### 2.3 主要フロー
1. **入札情報サービスの詳細ページを開く**
2. **拡張機能アイコンをクリック**
3. **「入札情報を取得」ボタンをクリック**
4. **データ自動抽出・整形・クリップボードへコピー**

### 2.4 UI設計

#### 2.4.1 拡張機能ポップアップ
```
┌─────────────────────────────────────────┐
│  国土交通省 入札案件抽出                │
├─────────────────────────────────────────┤
│                                         │
│  [📄 入札情報を取得]                    │
│   詳細ページから全情報を抽出            │
│                                         │
│  処理状態: 待機中                       │
│                                         │
└─────────────────────────────────────────┘
```

----------------------------------------------------------------
## 3. 想定ディレクトリ構成 (L2)

```
/src
├─ manifest.json          # 拡張機能設定
├─ popup/
│  ├─ popup.html         # ポップアップUI
│  ├─ popup.js           # ポップアップロジック
│  └─ popup.css          # スタイル
├─ content/
│  ├─ content.js         # メインコンテンツスクリプト
│  ├─ extractor.js       # データ抽出ロジック
│  └─ formatter.js       # データフォーマット
├─ background/
│  └─ background.js      # バックグラウンドサービスワーカー
└─ assets/
   └─ icons/
       ├─ icon16.png
       ├─ icon48.png
       └─ icon128.png
```

----------------------------------------------------------------
## 4. システムアーキテクチャ

```
┌────────────────────────────────────────┐
│     Chrome ブラウザ                    │
├────────────────────────────────────────┤
│  ┌──────────────┐  ┌────────────────┐│
│  │ Content Script│  │ Popup UI       ││
│  │ (詳細ページ) │←→│ (1ボタン)      ││
│  └──────────────┘  └────────────────┘│
│          ↑                    ↑        │
│          └────────┬───────────┘        │
│                   ↓                    │
│          ┌─────────────────┐          │
│          │ Background Script│          │
│          └─────────────────┘          │
└────────────────────────────────────────┘
         ↓
┌────────────────────────────────────────┐
│        クリップボード                  │
└────────────────────────────────────────┘
```

----------------------------------------------------------------
## 5. 技術スタック
- **フロントエンド**: Vanilla JavaScript, HTML5, CSS3
- **Chrome APIs**: 
  - chrome.runtime (メッセージング)
  - chrome.tabs (タブ操作)
  - chrome.scripting (スクリプト実行)
  - chrome.clipboardWrite (クリップボード操作)
- **Manifest Version**: 3
- **対応ブラウザ**: Chrome 90以上

----------------------------------------------------------------
## 6. データ抽出仕様

### 6.1 対象ページ
- **詳細ページのみ**: `https://www.i-ppi.jp/IPPI/SearchServices/Web/Koji/Kokoku/List_Detail.aspx*`

### 6.2 抽出対象項目
- 発注機関 (`lblHachukikan`)
- 工事名称 (`lblKojiNm`)
- 工事場所 (`lblKojiPlaceFrom`)
- 工事種別 (`lblKojiType`)
- 設計書番号 (`lblSekkeisyoNo`)
- 公告日時 (`lblKokokuDate`)
- 期限日時 (`lblkigenDate`)
- 開札日時 (`lblkasatuDate`)
- PDFファイルへのリンク

### 6.3 出力フォーマット (タブ区切り)
```
A列: 空欄
B列: 工事名称
C列: 設計書番号
D列: 発注機関の内、～省or内閣府or～県orいずれもない場合は発注機関の全文言
E列: 発注機関の内、D列以外を除いた全文言。D列に全て記載してしまった場合は空欄
F列: 公告日時
G列: 空欄
H列: 期限日時
I列: 開札日時
J列: PDFファイルへのURL
K列: 空欄
L列: 工事種別
```

----------------------------------------------------------------
## 7. 非機能要件
- **パフォーマンス**: 抽出処理は3秒以内に完了
- **互換性**: Chrome 90以上
- **セキュリティ**: 
  - Content Security Policy準拠
  - 外部サーバーへのデータ送信なし
  - ローカル処理のみ
- **ユーザビリティ**: 
  - 1クリックで操作完了
  - 明確なエラーメッセージ
- **エラーハンドリング**: 
  - 詳細ページ以外での実行時の適切なエラー表示
  - DOM要素が見つからない場合の適切な処理

----------------------------------------------------------------
## 8. 実装詳細

### 8.1 popup.js
- シンプルな1ボタンUI
- コンテンツスクリプトの存在確認（ping）
- 必要に応じたスクリプト注入
- エラーハンドリングとユーザーフィードバック

### 8.2 content.js
- 詳細ページの判定
- メッセージハンドリング
- エラーメッセージの統一

### 8.3 extractor.js
- DOM要素からのデータ抽出
- PDF URLの取得と絶対URL変換

### 8.4 formatter.js
- 発注機関の主要部・詳細部への分割
- 日時フォーマットの統一
- タブ区切り形式への変換

----------------------------------------------------------------
## 9. 変更履歴

### v2.0 (2025-07-21)
- 一覧ページ対応を削除
- 詳細ページ専用に特化
- UIを1ボタンに簡素化
- アーキテクチャの簡略化

### v1.0 (2025-07-20)
- 初版作成

----------------------------------------------------------------
## 10. 参考資料
- Chrome Extension API Documentation
- Manifest V3 Migration Guide
- 入札情報サービス利用規約